<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="utf-8">
    <title>Formulário de processos enviados ao Arquivo Central</title>

    <!-- jQuery -->
    <script src="jquery.min.js"></script>

    <!-- jQuery Input Mask -->
    <script src="jquery.mask.min.js"></script>

    <script type="text/javascript">
        function addRow(){
          var container = document.getElementById("listofprocesses");
          var newRow = document.createElement('div');

          var processNumber = document.createElement("input");
          processNumber.type = "text";
          processNumber.name = "num_processo[]";
          processNumber.placeholder = "0000000-00.0000";
          processNumber.size = "15";
          processNumber.required = true;
          processNumber.className = "mask-processo";

          var author = document.createElement("input");
          author.type = "text";
          author.name = "author[]";
          author.value = "";
          author.size = "30";
          author.required = true;

          var defendant = document.createElement("input");
          defendant.type = "text";
          defendant.name = "defendant[]";
          defendant.value = "";
          defendant.size = "30";
          defendant.required = true;

          newRow.appendChild(processNumber);
          newRow.appendChild(author);
          newRow.appendChild(defendant);
          container.appendChild(newRow);
        }

        function removeRow(){
            var table = document.getElementById("listofprocesses");
            var lastRow = table.lastChild;
            if(lastRow != null && lastRow.tagName == "DIV"){
              table.removeChild(lastRow);
            }else{
              alert("A tabela está vazia");
            }
        }

        function createTable(){
          var tableSize = document.getElementById('linhasdatabela').value;
          if (tableSize > 0) {
            for (var i = 0; i < tableSize; i++) {
              addRow();
            }

            // Mascara para o campo de processo
            jQuery(".mask-processo").mask("0000000-00.0000");

            // Mudar de campo quando o input
            jQuery(".mask-processo").on("change paste keyup input", function(e) {
              var val = this.value;
              if(val && val.length >= 15) {
                jQuery(this).next().focus();
              }
            });
          }
          else {
            alert("Dimensão da tabela é inválida.");
          }

        }

        function generateList(){
          var listofprocesses = document.getElementById('filingform');
          var total = listofprocesses.elements['num_processo[]'].length;

          //Defining the table elements
          var table = document.createElement("table");
          var row = table.insertRow(0);
          //defining the header
          row.insertCell(0).innerHTML = "<th>Número do processo</th>";
          row.insertCell(1).innerHTML = "<th>Parte Autora</th>";
          row.insertCell(2).innerHTML = "<th>Parte Requerida</th>";

          //adding data
          for (var i = 0; i < total; i++) {
            row = table.insertRow(-1);
            row.insertCell(0).innerHTML = listofprocesses.elements['num_processo[]'][i].value;
            row.insertCell(1).innerHTML = listofprocesses.elements['author[]'][i].value;
            row.insertCell(2).innerHTML = listofprocesses.elements['defendant[]'][i].value;
          }
          document.getElementsByTagName("body")[0].appendChild(table);
        }
    </script>
  </head>
  <body>
    <header>
       <h1>Listagem de processos enviados para o Arquivo Central</h1>
    </header>
    <form id="filingform">
      <div>
        <label for="caixa">Insira o número da Caixas-Arquivo:</label>
        <input type="text" id="caixa" name="num_cx" size="3">
      </div>
      <div>
        <label for="linhasdatabela">Insira o tamanho da tabela:</label>
        <input type="text" id="linhasdatabela" name="tamanho_da_tabela" value="20" size="2">
        <button type="button" name="criar_tabela" onclick="createTable();">Criar tabela</button>
      </div>
      <div id="listofprocesses" class="table">
        <span class='header'>Numero do processo</span>
        <span class="header">Parte autora</span>
        <span class="header">Parte Requerida</span><br>
      </div>
      <button type="button" name="add_new_line" onclick="addRow();">Add</button>
      <button type="button" name="remove_line" onclick="removeRow();">Remove</button>
      <button type="button" name="generate_list" onclick="generateList();">Gerar Lista</button>
    </form>
  </body>
</html>
